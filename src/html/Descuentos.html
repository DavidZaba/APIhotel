<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Descuentos</title>
    <!-- Enlace a Bootstrap CSS para estilos (opcional) -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Enlace a jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>

<div class="container mt-5">
    <h2>Agregar Descuento</h2>
    <form id="add-item-form">
      <div class="form-group">
          <label for="idapartamento">ID Apartamento</label>
          <input type="text" class="form-control" id="idapartamento" required>
      </div>
      <div class="form-group">
          <label for="descripcion">Descripción</label>
          <input type="text" class="form-control" id="descripcion" required>
      </div>
      <div class="form-group">
          <label for="precio">Precio</label>
          <input type="number" class="form-control" id="precio" required>
      </div>
      <div class="form-group">
          <label for="descuento">Descuento (%)</label>
          <input type="number" class="form-control" id="descuento" required>
      </div>
      <div class="form-group">
          <label for="precioDescuento">Precio con Descuento</label>
          <input type="number" class="form-control" id="precioDescuento" required>
      </div>
      <div class="form-group">
          <label for="fechaini">Fecha de Inicio</label>
          <input type="date" class="form-control" id="fechaini" required>
      </div>
      <div class="form-group">
          <label for="fechafin">Fecha de Fin</label>
          <input type="date" class="form-control" id="fechafin" required>
      </div>
      <div class="form-group">
          <label for="estado">Estado</label>
          <select class="form-control" id="estado" required>
              <option value="">Seleccione</option>
              <option value="activo">Activo</option>
              <option value="inactivo">Inactivo</option>
          </select>
      </div>
      <button type="submit" class="btn btn-primary">Agregar Descuento</button>
  </form>
  

    <h2 class="mt-5">Lista de Descuentos</h2>
    <table id="descuentosTable" class="table">
        <thead>
            <tr>
                <th scope="col">ID Apartamento</th>
                <th scope="col">Descripción</th>
                <th scope="col">Precio</th>
                <th scope="col">Descuento (%)</th>
                <th scope="col">Precio con Descuento</th>
                <th scope="col">Fecha Inicio</th>
                <th scope="col">Fecha Fin</th>
                <th scope="col">Estado</th>
                <th scope="col">Acciones</th>
            </tr>
        </thead>
        <tbody>
            <!-- Aquí se agregarán las filas dinámicamente -->
        </tbody>
    </table>
</div>

<script>
$(document).ready(function() {
    $('#add-item-form').submit(function (e) {
        e.preventDefault();

        const descuentoData = {
            idapartamento: $('#idapartamento').val(),
            descripcion: $('#descripcion').val(),
            precio: $('#precio').val(),
            descuento: $('#descuento').val(),
            precioDescuento: $('#precioDescuento').val(),
            fechaini: $('#fechaini').val(),
            fechafin: $('#fechafin').val(),
            estado: $('#estado').val()
        };

        console.log('Datos de Descuento:', descuentoData);

        $.ajax({
            url: 'http://localhost:3001/api/descuentos', // Cambia la URL a tu API de descuentos
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(descuentoData),
            success: function (response) {
                alert('Descuento agregado exitosamente');

                // Agregar la nueva fila a la tabla
                const newRow = `<tr data-id="${response._id}">
    <td>${response.idapartamento}</td>
    <td>${response.descripcion}</td>
    <td>${response.precio}</td>
    <td>${response.descuento}</td>
    <td>${response.precioDescuento}</td>
    <td>${response.fechaini}</td>
    <td>${response.fechafin}</td>
    <td>${response.estado}</td>
    <td>
        <button class="btn btn-sm btn-outline-primary">
            <i class="ti ti-pencil"></i>
        </button>
        <button class="btn btn-sm btn-outline-danger delete-button" data-id="${response._id}">
            <i class="ti ti-x"></i>
        </button>
    </td>
</tr>`;

                $('#descuentosTable tbody').append(newRow);
                
                // Limpiar el formulario después de agregar el descuento
                $('#add-item-form')[0].reset();
            },
            error: function (error) {
                alert('Error al agregar el descuento: ' + (error.responseJSON ? error.responseJSON.message : 'Error desconocido'));
            }
        });
    });
});
</script>

</body>
</html>
